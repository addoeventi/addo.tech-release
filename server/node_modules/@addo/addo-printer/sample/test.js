const ffi = require('ffi');
const ref = require('ref');

const lib = require('../lib/autoreplyprint');

const buf = ref.allocCString('Hello World');
const onPortOpened = ffi.Callback('void', ['void *', 'char *', 'void *'], function (handle, name, private_data) {
	lib.CP_Pos_PrintText(handle, 'Hello World');
	lib.CP_Pos_FeedLine(handle, 3);
	lib.CP_Pos_FullCutPaper(handle);
	lib.CP_Port_Close(handle);
	console.log(ref.readCString(name, 0));
	console.log(ref.readCString(private_data, 0));
});

lib.CP_Port_AddOnPortOpenedEvent(onPortOpened, buf);
lib.CP_Port_OpenUsb('/dev/usb/lp1', 0);

